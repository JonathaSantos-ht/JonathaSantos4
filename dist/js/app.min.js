(function(){
document.addEventListener("DOMContentLoaded", () => {
initFormValidation();
wireGlobalHandlers();
});
function wireGlobalHandlers(){
const nav = document.querySelector('.nav');
const btn = document.getElementById('btnMenu');
if(btn && nav && !btn.dataset.bound){
btn.dataset.bound = "1";
btn.addEventListener('click', () => {
const open = nav.classList.toggle('open');
btn.setAttribute('aria-expanded', open ? 'true' : 'false');
});
}
}
function initFormValidation(){
const form = document.getElementById("form-voluntario");
if(!form) return;
const alertBox = document.getElementById("alertForm");
form.addEventListener("submit", (e)=>{
let ok = true;
const nome = form.querySelector("#nome");
const email = form.querySelector("#email");
const cpf = form.querySelector("#cpf");
const telefone = form.querySelector("#telefone");
const cep = form.querySelector("#cep");
const req = (el, cond=true)=>{
const v = (el?.value||"").trim();
const valid = cond && v.length>0;
mark(el, valid); return valid;
}
const mark = (el, good)=>{ if(!el) return; el.classList.toggle("is-invalid", !good); }
ok = req(nome) && ok;
ok = req(email, /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test((email?.value||"").trim())) && ok;
const cepVal = (cep?.value||"").trim();
const cepFmt = /^\d{5}-\d{3}$/.test(cepVal);
ok = req(cep, cepFmt) && ok;
const cpfVal = (cpf?.value||"").trim();
const cpfFmt = /^\d{3}\.\d{3}\.\d{3}-\d{2}$/.test(cpfVal);
let cpfAlg = false;
if(cpfFmt){
const d = cpfVal.replace(/\D/g,"");
cpfAlg = validateCPF(d);
}
ok = req(cpf, cpfFmt && cpfAlg) && ok;
ok = req(telefone) && ok;
if(!ok){
e.preventDefault();
if(alertBox) alertBox.style.display = "block";
showToast("Corrija os campos destacados");
return;
}
if(alertBox) alertBox.style.display = "none";
const data = Object.fromEntries(new FormData(form).entries());
try{ localStorage.setItem("voluntario", JSON.stringify(data)); }catch(e){}
showToast("Cadastro enviado com sucesso!");
form.reset();
}, { once: false });
}
function validateCPF(d){
if(!/^\d{11}$/.test(d)) return false;
if(/^(\d)\1{10}$/.test(d)) return false;
let sum=0, rest;
for(let i=1;i<=9;i++) sum += parseInt(d.substring(i-1,i)) * (11 - i);
rest = (sum * 10) % 11; if(rest==10||rest==11) rest = 0;
if(rest != parseInt(d.substring(9,10))) return false;
sum = 0;
for(let i=1;i<=10;i++) sum += parseInt(d.substring(i-1,i)) * (12 - i);
rest = (sum * 10) % 11; if(rest==10||rest==11) rest = 0;
if(rest != parseInt(d.substring(10,11))) return false;
return true;
}
function showToast(msg){
let t = document.getElementById("toast");
if(!t){
t = document.createElement("div");
t.id = "toast";
t.className = "toast show";
document.body.appendChild(t);
}
t.textContent = msg;
t.classList.add("show");
setTimeout(()=> t.classList.remove("show"), 3000);
}
window.copyText = function(sel){
const el = document.querySelector(sel);
if(!el) return;
const txt = el.textContent.trim();
navigator.clipboard.writeText(txt).then(()=> showToast("Chave PIX copiada!"));
}
window.toggleModal = function(open=true){
const el = document.querySelector(".modal-backdrop");
if(!el) return;
el.classList.toggle("open", open);
el.setAttribute("aria-hidden", open ? "false" : "true");
}
})();
(function(){
function onlyDigits(s){ return (s||"").replace(/\D/g,""); }
function formatCPF(value){
const d = onlyDigits(value).slice(0,11);
if(d.length <= 3) return d;
if(d.length <= 6) return d.replace(/(\d{3})(\d+)/, "$1.$2");
if(d.length <= 9) return d.replace(/(\d{3})(\d{3})(\d+)/, "$1.$2.$3");
return d.replace(/(\d{3})(\d{3})(\d{3})(\d{0,2})/, "$1.$2.$3-$4");
}
function formatCEP(value){
const d = onlyDigits(value).slice(0,8);
if(d.length <= 5) return d;
return d.replace(/(\d{5})(\d{0,3})/, "$1-$2");
}
function forceTextNumeric(el){
if(!el) return;
try{
el.setAttribute("type","text");       // permite pontos e hífen
el.setAttribute("inputmode","numeric"); // teclado numérico no mobile
el.setAttribute("autocomplete","on");
}catch(e){}
}
function attachMask(inputEl, formatter){
if(!inputEl) return;
forceTextNumeric(inputEl);
const apply = ()=>{
const before = inputEl.value;
inputEl.value = formatter(before);
try{ inputEl.setSelectionRange(inputEl.value.length, inputEl.value.length); }catch(e){}
};
apply();
inputEl.addEventListener('input', apply, {passive:true});
inputEl.addEventListener('blur', apply);
inputEl.addEventListener('focus', apply);
inputEl.addEventListener('paste', (ev)=>{
ev.preventDefault();
const text = (ev.clipboardData || window.clipboardData).getData('text') || "";
inputEl.value = formatter(text);
try{ inputEl.setSelectionRange(inputEl.value.length, inputEl.value.length); }catch(e){}
});
}
window.enableMasksCPF_CEP = function(scope){
const root = scope || document;
const cpf = root.querySelector('#cpf, [name="cpf"]');
const cep = root.querySelector('#cep, [name="cep"]');
attachMask(cpf, formatCPF);
attachMask(cep, formatCEP);
};
if(document.readyState === 'loading'){
document.addEventListener('DOMContentLoaded', ()=>{ try{ window.enableMasksCPF_CEP(); }catch(e){} });
} else {
try{ window.enableMasksCPF_CEP(); }catch(e){}
}
})();